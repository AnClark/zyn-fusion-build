diff --git a/include/mruby.h b/include/mruby.h
index 8adce28..beedbdd 100644
--- a/include/mruby.h
+++ b/include/mruby.h
@@ -28,6 +28,7 @@
 #ifndef MRUBY_H
 #define MRUBY_H
 
+
 #ifdef __cplusplus
 #define __STDC_LIMIT_MACROS
 #define __STDC_CONSTANT_MACROS
@@ -37,6 +38,11 @@
 #include <stdint.h>
 #include <stddef.h>
 #include <limits.h>
+#include <float.h>
+
+#ifndef DBL_EPSILON
+#define DBL_EPSILON 1e-6
+#endif
 
 #ifdef __cplusplus
 #ifndef SIZE_MAX
@@ -48,6 +54,7 @@
 #endif
 #endif
 
+
 #ifdef MRB_DEBUG
 #include <assert.h>
 #define mrb_assert(p) assert(p)
diff --git a/src/backtrace.c b/src/backtrace.c
index 1006f2f8..bf58aa3e 100644
--- a/src/backtrace.c
+++ b/src/backtrace.c
@@ -76,13 +76,16 @@ each_backtrace(mrb_state *mrb, ptrdiff_t ciidx, const mrb_code *pc0, each_backtr

 #ifndef MRB_NO_STDIO

+char superhack[1024*20];
+
 static void
 print_backtrace(mrb_state *mrb, struct RObject *exc, mrb_value backtrace)
 {
   mrb_int i;
   mrb_int n = RARRAY_LEN(backtrace);
   mrb_value *loc, mesg;
-  FILE *stream = stderr;
+  // FILE *stream = stderr;
+  char stream[1000];

   if (n != 0) {
     fprintf(stream, "trace (most recent call last):\n");
@@ -92,9 +95,11 @@ print_backtrace(mrb_state *mrb, struct RObject *exc, mrb_value backtrace)
                 (int)i, (int)RSTRING_LEN(*loc), RSTRING_PTR(*loc));
       }
     }
-    if (mrb_string_p(*loc)) {
-      fprintf(stream, "%.*s: ", (int)RSTRING_LEN(*loc), RSTRING_PTR(*loc));
-    }
+    //if (mrb_string_p(*loc)) {
+    //  fprintf(stream, "%.*s: ", (int)RSTRING_LEN(*loc), RSTRING_PTR(*loc));
+    //}
+    sprintf(stream, "\t[%d] %.*s\n", i, (int)RSTRING_LEN(*loc), RSTRING_PTR(*loc));
+    strcat(superhack, stream);
   }
   mesg = mrb_exc_inspect(mrb, mrb_obj_value(exc));
   fprintf(stream, "%.*s\n", (int)RSTRING_LEN(mesg), RSTRING_PTR(mesg));
diff --git a/src/fmt_fp.c b/src/fmt_fp.c
index 483e04c..19633c0 100644
--- a/src/fmt_fp.c
+++ b/src/fmt_fp.c
@@ -36,6 +36,10 @@ SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 #include <mruby.h>
 #include <mruby/string.h>
 
+#ifndef LDBL_EPSILON
+#define LDBL_EPSILON 1e-6
+#endif
+
 struct fmt_args {
   mrb_state *mrb;
   mrb_value str;
